<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从头开始搭一个 webpack5 库项目脚手架 | Nothing Here</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="什么都没有">
    
    <link rel="preload" href="/vuepress-blog/assets/css/1.styles.709f6203.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.5b657c9d.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/3.d7b46cbf.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/12.812ca7e8.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/10.ec2cdb3b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/11.b51e2596.js"><link rel="prefetch" href="/vuepress-blog/assets/js/13.e25cac9c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/14.7a9d0fb7.js"><link rel="prefetch" href="/vuepress-blog/assets/js/15.8d405573.js"><link rel="prefetch" href="/vuepress-blog/assets/js/16.42350508.js"><link rel="prefetch" href="/vuepress-blog/assets/js/2.21ebc214.js"><link rel="prefetch" href="/vuepress-blog/assets/js/4.1099819e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.1bfec37d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.dc5e901a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/7.2dd73b7f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/8.750656c5.js"><link rel="prefetch" href="/vuepress-blog/assets/js/9.7e14d47c.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/1.styles.709f6203.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container vuepress-theme-simple"><header class="header"><a href="/vuepress-blog/" title="什么都没有" class="site-name router-link-active">
      Nothing Here
    </a> <div style="clear: both"></div> <!----></header> <section class="post-view"><div class="post-head"><h1 class="post-title">
      从头开始搭一个 webpack5 库项目脚手架
    </h1> <time datetime="3/19/2021, 5:38:44 AM" title="3/19/2021, 5:38:44 AM" pubdate="pubdate" class="post-date">
  2 weeks ago
</time></div> <div class="content__default"><h1 id="从头开始搭一个-webpack5-库项目脚手架"><a href="#从头开始搭一个-webpack5-库项目脚手架" class="header-anchor">#</a> 从头开始搭一个 webpack5 库项目脚手架</h1> <p>现在呢，我要做一个组件，假设它是一个抽奖组件，使用到的技术是 ES6, handlebars, 我用最新的 webpack5 来做项目脚手架.</p> <ol><li>首先，生成一个 package.json</li></ol> <div class="language- extra-class"><pre class="language-text"><code>mkdir lottery
cd lottery
npm init -y
</code></pre></div><ol start="2"><li>新建一些必要的文件</li></ol> <ul><li>public/index.html 这个是页面 html 模板</li> <li>src/index.js 这个是入口文件</li> <li>webpack.config.js webpack 配置文件</li> <li>.gitignore</li> <li>.babelrc babel 配置</li></ul> <ol start="3"><li>安装 webpack, webpack-cli</li></ol> <div class="language- extra-class"><pre class="language-text"><code>yarn add -D webpack webpack-cli
</code></pre></div><p>然后 webpack.config.js 的内容改成</p> <div class="language- extra-class"><pre class="language-text"><code>// webpack.config.js

module.exports = {
  entry: './src/index.js',
  output: {
    library: {
      name: 'Lottery',
      type: 'umd',
      export: 'default'
    }
  },
  filename: 'lottery.js',
  resolve: {
    extensions: ['*', '.js']
  }
}
</code></pre></div><ol start="3"><li>开发时候，我们要用到<code>webpack-dev-server</code>,用来生成一个开发服务器，以及做热更新之类的。 这里注意下，要用最新的 4.0 beta 版本</li></ol> <div class="language- extra-class"><pre class="language-text"><code>yarn add -D webpack-dev-server@4
</code></pre></div><p>然后 package.json 的<code>scripts</code>里，添加两个脚本</p> <div class="language- extra-class"><pre class="language-text"><code>  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;webpack --mode production&quot;,
    &quot;dev&quot;: &quot;webpack serve --mode development&quot;
  },
</code></pre></div><p>在 webpack.config.js 里, 添加 devServer 的相关配置</p> <div class="language- extra-class"><pre class="language-text"><code>  devServer: {
    host: '0.0.0.0',
    static: path.join(__dirname, 'dist'),
    compress: false,
    port: 3333
  }
</code></pre></div><ol start="4"><li>安装 babeljs, 它把我们写的 ES6 以上的语法编译成 ES2015 的，这样可以有更好的兼容性。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>yarn add -D @babel/core @babel/preset-env babel-loader
</code></pre></div><p>然后在 webpack.config.js, 增加 babel-loader 的配置</p> <div class="language- extra-class"><pre class="language-text"><code>module: {
  rules: [
      {
        test: /\.(js)$/,
        exclude: /node_modules/,
        use: ['babel-loader']
      },
  ]
}
</code></pre></div><p>把根目录的.babelrc，改成这样</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;presets&quot;: [&quot;@babel/preset-env&quot;]
}

</code></pre></div><ol start="5"><li>我们项目用的是 SCSS，所以要添加 scss 支持</li></ol> <div class="language- extra-class"><pre class="language-text"><code>yarn add -D css-loader node-sass sass-loader style-loader
</code></pre></div><p>然后在 webpack.config.js, 增加 scss 配置</p> <div class="language- extra-class"><pre class="language-text"><code>module: {
  rules: [
    ...
    {
      test: /\.(scss|css)$/,
      use: ['style-loader', 'css-loader', 'sass-loader']
    },
  ]
}
</code></pre></div><ol start="6"><li>添加 handlebars 支持</li></ol> <div class="language- extra-class"><pre class="language-text"><code>yarn add handlebars

yarn add handlebars-loader -D
</code></pre></div><p>然后在 webpack.config.js, 增加 handlebars 配置</p> <div class="language- extra-class"><pre class="language-text"><code>module: {
  rules: [
    ...
    { test: /\.hbs$/, loader: 'handlebars-loader' }
  ]
}
</code></pre></div><ol start="7"><li>安装 HtmlWebpackPlugin</li></ol> <div class="language- extra-class"><pre class="language-text"><code>yarn add -D HtmlWebpackPlugin
</code></pre></div><p>然后在 webpack.config.js, 增加 HtmlWebpackPlugin 配置</p> <div class="language- extra-class"><pre class="language-text"><code>  plugins: [
    new HtmlWebpackPlugin({
      filename: 'index.html',
      template: './public/index.html', // 使用public里的模板
      inject: 'head', // 因为我们做的是库文件，所以插到头部去
      scriptLoading: 'blocking' // 这个要改成blocking, 不然会异步加载
    })
  ],
</code></pre></div><p>public/index.html 像这样：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;title&gt;Document&lt;/title&gt;
  &lt;script src=&quot;//img1.igg.com/lib/jquery/1.12.4/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;div id=&quot;lottery&quot;&gt;&lt;/div&gt;

  &lt;script&gt;
    var lottery = new Lottery({
      el: '#lottery',
      lotteryId: 3389
    })
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre></div><p>最终，package.json 大概是这样：</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;name&quot;: &quot;sy-lottery&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;dist/lottery.js&quot;,
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;webpack --mode production&quot;,
    &quot;dev&quot;: &quot;webpack serve --mode development&quot;
  },
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;devDependencies&quot;: {
    &quot;@babel/core&quot;: &quot;^7.13.10&quot;,
    &quot;@babel/preset-env&quot;: &quot;^7.13.10&quot;,
    &quot;babel-loader&quot;: &quot;^8.2.2&quot;,
    &quot;css-loader&quot;: &quot;^5.1.3&quot;,
    &quot;handlebars-loader&quot;: &quot;^1.7.1&quot;,
    &quot;html-webpack-plugin&quot;: &quot;^5.3.1&quot;,
    &quot;node-sass&quot;: &quot;^5.0.0&quot;,
    &quot;sass-loader&quot;: &quot;^11.0.1&quot;,
    &quot;style-loader&quot;: &quot;^2.0.0&quot;,
    &quot;stylelint&quot;: &quot;^13.12.0&quot;,
    &quot;stylelint-config-rational-order&quot;: &quot;^0.1.2&quot;,
    &quot;stylelint-config-standard&quot;: &quot;^21.0.0&quot;,
    &quot;stylelint-order&quot;: &quot;^4.1.0&quot;,
    &quot;stylelint-scss&quot;: &quot;^3.19.0&quot;,
    &quot;webpack&quot;: &quot;^5.26.3&quot;,
    &quot;webpack-cli&quot;: &quot;^4.5.0&quot;,
    &quot;webpack-dev-server&quot;: &quot;^4.0.0-beta.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;handlebars&quot;: &quot;^4.7.7&quot;
  }
}

</code></pre></div><p>webpack.config.js 长这样：</p> <div class="language- extra-class"><pre class="language-text"><code>const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')

module.exports = {
  entry: './src/index.js',
  output: {
    library: {
      name: 'Lottery',
      type: 'umd',
      export: 'default'
    },
    filename: 'lottery.js'
  },
  module: {
    rules: [
      {
        test: /\.(js)$/,
        exclude: /node_modules/,
        use: ['babel-loader']
      },
      {
        test: /\.(scss|css)$/,
        use: ['style-loader', 'css-loader', 'sass-loader']
      },
      { test: /\.hbs$/, loader: 'handlebars-loader' }
    ]
  },
  resolve: {
    extensions: ['*', '.js']
  },
  plugins: [
    new HtmlWebpackPlugin({
      filename: 'index.html',
      template: './public/index.html',
      inject: 'head',
      scriptLoading: 'blocking'
    })
  ],
  devServer: {
    host: '0.0.0.0',
    static: path.join(__dirname, 'dist'),
    compress: false,
    port: 3333
  }
}

</code></pre></div></div></section> <footer class="footer">
  © 2021
  <i class="icon-user"></i>
  Will.H
  <br>
  Powered by
  <a href="https://vuepress.vuejs.org/" rel="noopener" target="_blank">VuePress</a>
  | Theme
  <a href="https://github.com/viko16/vuepress-theme-simple" rel="noopener" target="_blank">Simple</a></footer></div><div class="global-ui"></div></div>
    <script src="/vuepress-blog/assets/js/app.5b657c9d.js" defer></script><script src="/vuepress-blog/assets/js/3.d7b46cbf.js" defer></script><script src="/vuepress-blog/assets/js/12.812ca7e8.js" defer></script>
  </body>
</html>
