(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{160:function(e,s,t){"use strict";t.r(s);var a=t(6),n=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"项目脚手架-webpack-升级到-5-需要修改的一些东西"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#项目脚手架-webpack-升级到-5-需要修改的一些东西"}},[e._v("#")]),e._v(" 项目脚手架 webpack 升级到 5 需要修改的一些东西")]),e._v(" "),t("p",[e._v("今天把公司项目脚手架的 webpack 升级到 5, 操作步骤如下：")]),e._v(" "),t("ol",[t("li",[e._v("升级"),t("code",[e._v("webpack")]),e._v(", "),t("code",[e._v("webpack-cli")]),e._v(", "),t("code",[e._v("webpack-dev-server")])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("yarn add webpack webpack-cli webpack-dev-server@4 -D\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[e._v("升级其它依赖包")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("yarn upgrade-interactive --latest\n")])])]),t("p",[e._v("之后选择需要升级的包，我这里基本上全部勾上了.")]),e._v(" "),t("p",[e._v("大体上还是比较顺利的，有几个需要注意的地方：")]),e._v(" "),t("ol",[t("li",[e._v("默认打包的 JS 文件里有箭头函数，这个在 output 里改")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("output: {\n  environment: {\n    arrowFunction: false\n  }\n},\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[t("code",[e._v("postcss-loader")]),e._v("的"),t("code",[e._v("plugins")]),e._v("选项改到"),t("code",[e._v("postcssOptions")]),e._v("里")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// 原来\n{\n  loader: 'postcss-loader',\n  options: {\n    plugins: [\n      require('postcss-preset-env')(),\n      require('postcss-pxtorem')({\n        rootValue: 100,\n        propWhiteList: [],\n        exclude: file => {\n          return file.indexOf('pc') > -1\n        }\n      })\n    ]\n  }\n},\n\n// 新\n{\n  loader: 'postcss-loader',\n  options: {\n    postcssOptions: {\n      plugins: [\n        require('postcss-preset-env')(),\n        require('postcss-pxtorem')({\n          rootValue: 100,\n          propWhiteList: [],\n          exclude: file => {\n            return file.indexOf('pc') > -1\n          }\n        })\n      ]\n    }\n  }\n},\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[t("code",[e._v("sass-loader")]),e._v("的"),t("code",[e._v("prependData")]),e._v("改成了"),t("code",[e._v("additionalData")]),e._v("， 另外参数有变化，且需要 return 原 content")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// 原来\nprependData: (loaderContext) => {\n  const { resourcePath } = loaderContext\n  if (resourcePath.includes('/pages/') || resourcePath.includes('\\\\pages\\\\')) {\n    return `\n      @import \"./src/assets/scss/_mixin.scss\";\n      @import \"./src/assets/scss/gb.scss\";\n    `\n  }\n}\n\n\n// 新\nadditionalData: (content, loaderContext) => {\n  const { resourcePath } = loaderContext\n  if (resourcePath.includes('/pages/') || resourcePath.includes('\\\\pages\\\\')) {\n    return `\n      @import \"./src/assets/scss/_mixin.scss\";\n      @import \"./src/assets/scss/gb.scss\";\n      ${content}\n    `\n  }\n  return content\n}\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[t("code",[e._v("webpack-merge")]),e._v("不再默认导出"),t("code",[e._v("merge")])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// 原来\nconst merge = require('webpack-merge')\n\n// 新\nconst { merge } = require('webpack-merge')\n")])])]),t("ol",{attrs:{start:"5"}},[t("li",[e._v("devServer 需要 4.0beta 版本，变得比较多, 这里可以先看一下 changelog, "),t("a",{attrs:{href:"https://github.com/webpack/webpack-dev-server/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/webpack/webpack-dev-server/releases"),t("OutboundLink")],1)])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("devServer: {\n  static: [consts.DIST_ROOT, 'public'], // contentBase => static\n  host: '0.0.0.0',\n  port: consts.DEV_PORT,\n  hot: true,\n  firewall: false, // 原disableHostCheck => firewall里\n  dev: {\n    writeToDisk: true // 原writeToDisk 集成到dev选项里\n  }\n}\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);